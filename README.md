# DSCI 522 Project: Wine Quality Predictors

### Team Members
- Reza Bagheri (github ID: reza-bagheri)
- Luo Yang (github ID: lyiris22)

### Summary

In this project, we used the [Wine Quality Data Set](https://archive.ics.uci.edu/ml/datasets/Wine+Quality) to explore the effect of different parameters on wine quality. The main method we used is the decision tree from [scikit-learn](https://scikit-learn.org/stable/modules/generated/sklearn.tree.DecisionTreeClassifier.html) to rank the importance of parameters, separately for red wine and white wine. We wrote R scripts to clean the data and make visualizations, and a Python script to generate decision tree.

Among the 11 features of wine, our result shows that *sulphates*, *alcohol*, and *volatile acidity* are the three top predictors to red wine quality respectively. For white wine, the three top predictors are *alcohol*, *free sulfur dioxide*, and	*volatile acidity*. Our final report include the details of analysis and how we came to the final conclusion.

### Data Analysis

The scripts we use are in the `src` folder.

First, we used [load_write_raw_data.R](https://github.com/UBC-MDS/DSCI_522_wine-quality-predictors/blob/master/src/load_write_raw_data.R) to load the [Wine Quality Data Set](https://archive.ics.uci.edu/ml/datasets/Wine+Quality) from URL, and save the raw data to csv files in `results` folder.

Secondly, we used [load_clean_3_targets.R](https://github.com/UBC-MDS/DSCI_522_wine-quality-predictors/blob/master/src/load_clean_3_targets.R) and [load_clean_4_targets.R](https://github.com/UBC-MDS/DSCI_522_wine-quality-predictors/blob/master/src/load_clean_4_targets.R) to re-organize the quality labels. The `load_clean_4_targets.R` combined the quality into "low", "med_low", "med_high" and "high", while the `load_clean_3_targets.R` combined into "low", "med", and "high". We have these two scripts because we need to check which method is a better way to balance the data and fit a decision tree. Both scripts takes the clean data generated by `load_write_raw_data.R` as input, and produce a csv file of clean data.

Then, we used [plot_violin.R](https://github.com/UBC-MDS/DSCI_522_wine-quality-predictors/blob/master/src/plot_violin.R) and [plot_hist.R](https://github.com/UBC-MDS/DSCI_522_wine-quality-predictors/blob/master/src/plot_hist.R) to create visulizations for the clean data. `plot_violin.R` takes the cleaned data created by the scripts above as file input. It produces a png file of violin plots as output. `plot_hist.R` takes four data sets, which are the raw and clean data for both red and white wine, as input. It produces four histograms, one for each data set, as the output.

After that, we used [draw_tree.py](https://github.com/UBC-MDS/DSCI_522_wine-quality-predictors/blob/master/src/draw_tree.py) to generate decision trees for the data sets. It takes the clean data as file input, variables to specify whether the data contains 3 or 4 targets, as well as if we want the data to be balanced or not. It produces an decision tree graph, a csv file to show the importances for each feature, and add the cross validation score for the set to a csv file that records all the scores for each data set.

Finally, we summarized our results and made a report [Report.md](https://github.com/UBC-MDS/DSCI_522_wine-quality-predictors/blob/master/doc/Report.md) in `doc` folder.

An example of running the scripts by command line is below:

```
# load and write the raw data
Rscript src/load_write_raw_data.R 'https://archive.ics.uci.edu/ml/machine-learning-databases/wine-quality/winequality-red.csv' data/raw_red.csv
Rscript src/load_write_raw_data.R 'https://archive.ics.uci.edu/ml/machine-learning-databases/wine-quality/winequality-white.csv' data/raw_white.csv

# clean the raw data to divide quality into low, med_low, med_high, high
Rscript src/load_clean_4_targets.R data/raw_red.csv data/clean_red_4_targets.csv
Rscript src/load_clean_4_targets.R data/raw_white.csv data/clean_white_4_targets.csv

# clean the raw data to divide quality into low, med, high
Rscript src/load_clean_3_targets.R data/raw_red.csv data/clean_red_3_targets.csv
Rscript src/load_clean_3_targets.R data/raw_white.csv data/clean_white_3_targets.csv

# create violin plots for the 3 targets data
Rscript src/plot_violin.R data/clean_red_3_targets.csv results/violin_red.png
Rscript src/plot_violin.R data/clean_white_3_targets.csv results/violin_white.png

# create histograms for raw and clean data sets
Rscript src/plot_hist.R data/raw_red.csv data/raw_white.csv data/clean_red_3_targets.csv data/clean_white_3_targets.csv results/hist_raw_red.png results/hist_raw_white.png results/hist_clean_red.png results/hist_clean_white.png

# create decision trees for the 4 targets data
Python src/draw_tree.py data/clean_red_4_targets.csv results/tree_red_4 results/tree_scores.csv results/red_4_imp.csv 4 false
Python src/draw_tree.py data/clean_red_4_targets.csv results/tree_red_4_bal results/tree_scores.csv results/red_4_bal_imp.csv 4 true
Python src/draw_tree.py data/clean_white_4_targets.csv results/tree_white_4 results/tree_scores.csv results/white_4_imp.csv 4 false
Python src/draw_tree.py data/clean_white_4_targets.csv results/tree_white_4_bal results/tree_scores.csv results/white_4_bal_imp.csv 4 true

# create decision trees for the 3 targets data
Python src/draw_tree.py data/clean_red_3_targets.csv results/tree_red_3 results/tree_scores.csv results/red_3_imp.csv 3 false
Python src/draw_tree.py data/clean_red_3_targets.csv results/tree_red_3_bal results/tree_scores.csv results/red_3_bal_imp.csv 3 true
Python src/draw_tree.py data/clean_white_3_targets.csv results/tree_white_3 results/tree_scores.csv results/white_3_imp.csv 3 false
Python src/draw_tree.py data/clean_white_3_targets.csv results/tree_white_3_bal results/tree_scores.csv results/white_3_bal_imp.csv 3 true

# make final report
Rscript -e "rmarkdown::render('doc/Report.Rmd')"
```

We also have an shell script [run_all.sh](https://github.com/UBC-MDS/DSCI_522_wine-quality-predictors/blob/master/run_all.sh) in the root folder.

### Dependencies

- R packages:
  - dplyr
  - tidyverse
  - cowplot

- Python packages:
  - numpy
  - pandas
  - sklearn
  - graphviz
  - argparse
